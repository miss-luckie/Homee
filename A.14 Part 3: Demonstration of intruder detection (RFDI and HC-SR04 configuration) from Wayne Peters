FUNCTION rfid_loop:
SET last_uid, rfid_alert_flag AS global variables

WHILE continue_reading IS TRUE:
 (status, tag_type) ← RFID_Request(IDLE_MODE)

 IF status IS OK:
  (status, uid) ← RFID_SelectTag()

  IF status IS OK:
   uid_str ← Convert UID bytes to uppercase hex string
   DISPLAY “Card detected UID: ” + uid_str

   LOCK lcd_lock
   CLEAR LCD display

   IF uid_str EQUALS last_uid:
    DISPLAY “Goodbye” on LCD
    LOG event “RFID Scan OUT” with uid_str
    SET last_uid ← None
   ELSE:
    DISPLAY “Welcome” on LCD
    LOG event “RFID Scan IN” with uid_str
    SET last_uid ← uid_str
   UNLOCK lcd_lock

   TURN ON green LED (red_off, green_on, blue_off)
   WAIT 2 seconds
   TURN OFF all LEDs

   LOCK rfid_lock
   SET rfid_alert_flag ← TRUE
   UNLOCK rfid_lock
